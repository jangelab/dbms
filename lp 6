create table stud2
(
usn number(10),
sem varchar(10),
name varchar(20),
constraint pkk1 primary key(usn)
);

create table course
(
title varchar(20) unique,
cid number(10),
credits number(10),
constraint pk44 primary key(cid)
);

create table enroll
(
usn number(10),
cid number(10),
constraint pk54 primary key(usn,cid),
constraint fk44 foreign key(cid) references course(cid),
constraint fk54 foreign key(usn) references stud2(usn)
);



insert into stud2 values(901,7,'josh');
insert into stud2 values(902,5,'guru');
insert into stud2 values(903,7,'srini');
insert into stud2 values(904,3,'turre');
insert into stud2 values(905,3,'rupa');
insert into stud2 values(906,5,'piggi');
insert into stud2 values(907,6,'jos');

insert into course values('dbms',301,4);
insert into course values('ld',302,5);
insert into course values('ds',303,4);
insert into course values('oops',304,4);
insert into course values('ada',305,3);
insert into course values('se',306,4);
insert into course values('cn',307,4);

insert into enroll values(901,301);
insert into enroll values(902,301);
insert into enroll values(903,303);
insert into enroll values(904,304);
insert into enroll values(901,302);
insert into enroll values(901,303);
insert into enroll values(901,304);
insert into enroll values(901,305);
insert into enroll values(903,305);
insert into enroll values(901,306);
insert into enroll values(901,307);



select count(s.usn)
from stud2 s,course c,enroll e
where s.usn=e.usn and e.cid=c.cid and c.title='dbms';


select s.name
from stud2 s,course c,enroll e
where s.usn=e.usn and e.cid=c.cid and c.title='ds'
minus
select s.name
from stud2 s,course c,enroll e
where s.usn=e.usn and e.cid=c.cid and c.title='ld';


create or replace trigger trr6
before insert on enroll
for each row
declare
var1 number;
begin
select count(*) into var1 from enroll where usn=:new.usn;
if(var1>=6)
then
raise_application_error(-20009,'limit reached');
end if;
end;
/

insert into enroll values(901,308);


create or replace procedure prr6
is
x course%rowtype;
cursor c is select distinct(c1.title) from course c1, stud2 s, enroll e where s.usn=e.usn and c1.cid=e.cid and s.sem='7';
begin
for x in c loop
sys.dbms_output.put_line(x.title);
end loop;
end;
/
set serveroutput on;
exec prr6;
